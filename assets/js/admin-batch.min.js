"use strict";!function(o){var i={form:{beforeSubmit:function(a){var e=a.find('.pum-field-submit input[type="submit"]'),t=a.find(".pum-upgrade-messages"),s=a.find(".pum-batch-progress"),r=a.data("ays");return!e.hasClass("button-disabled")&&(!(void 0!==r&&!confirm(r))&&(s.removeClass("pum-batch-progress--active"),s.find("progress").prop("value",null),t.html(""),e.addClass("button-disabled"),o('<span class="spinner is-active"></span>').insertAfter(e),!0))}},complete:function(a){var e=a.parents(".pum-alert");a.find(".pum-field-submit, progress").hide(),o("p.pum-upgrade-notice").hide(),e.removeClass("pum-alert__warning").addClass("pum-alert__success"),e.prepend("<h2>"+pum_batch_vars.complete+"</h2>")},action:"pum_process_batch_request",process_step:function(a,n){var d=this;o.ajax({type:"POST",url:ajaxurl,data:{batch_id:n.batch_id,action:d.action,nonce:n.nonce,form:n.form,step:parseInt(a),data:n},dataType:"json",success:function(a){if(a.data.done||a.data.error){var e=a.data.mapping?".pum-batch-import-form":".pum-batch-form",t=o(e),s=t.find(".spinner"),r=t.find(".notice-wrap");t.find(".button-disabled").removeClass("button-disabled"),a.data.error?(s.remove(),r.html('<div class="updated error"><p>'+a.data.error+"</p></div>")):a.data.done?(s.remove(),r.html('<div id="pum-batch-success" class="updated notice"><p class="pum-batch-success">'+a.data.message+"</p></div>"),a.data.url&&(window.location=a.data.url)):r.remove()}else o(".pum-batch-progress div").animate({width:a.data.percentage+"%"},50),d.process_step(a.data.step,n)}}).fail(function(a){window.console&&window.console.log&&console.log(a)})}},s=o.extend(!0,{},i,{action:"pum_process_upgrade_request",process_step:function(a,n){var d=this;o.ajax({type:"POST",url:ajaxurl,data:{upgrade_id:n.upgrade_id,action:d.action,nonce:n.nonce,form:n.form,step:parseInt(a),data:n},dataType:"json",success:function(a){var e=o(".pum-upgrade-form"),t=e.find(".spinner"),s=e.find(".button-disabled"),r=e.find(".pum-upgrade-messages");a.data.done||a.data.error?(s.removeClass("button-disabled"),a.data.error?(t.remove(),r.prepend('<div class="notice notice-error notice-alt"><p>'+a.data.error+"</p></div>")):a.data.done?(r.prepend('<div class="notice notice-success"><p><strong>'+a.data.message+"</strong></p></div>"),a.data.next?(e.data("upgrade_id",a.data.next).data("step",1).data("ays",!1),d.process_step(1,{upgrade_id:a.data.next,nonce:n.nonce,form:n.form})):(s.parent().hide(),t.remove(),i.complete(e)),a.data.url&&(window.location=a.data.url)):""!==a.data.message&&r.prepend('<div class="notice"><p class="">'+a.data.message+"</p></div>")):(""!==a.data.message&&r.prepend('<div class="notice"><p class="">'+a.data.message+"</p></div>"),o(".pum-batch-progress").addClass("pum-batch-progress--active"),o(".pum-batch-progress progress.pum-task-progress").addClass("active").val(a.data.percentage),d.process_step(a.data.step,n))}}).fail(function(a){window.console&&window.console.log&&console.log(a)})}});window.PUM_Admin=window.PUM_Admin||{},window.PUM_Admin.batch=i,window.PUM_Admin.batch_upgrades=s,o(document).on("submit",".pum-batch-form[data-batch_id]",function(a){var e=o(this),t=e.find('input[type="submit"]'),s=e.data("ays"),r={batch_id:e.data("batch_id"),nonce:e.data("nonce"),form:e.serializeAssoc(),test:e.pumSerializeObject()};if(a.preventDefault(),!t.hasClass("button-disabled")){if(void 0!==s&&!confirm(s))return;e.find(".notice-wrap").remove(),e.append(o('<div class="notice-wrap"><div class="pum-batch-progress"><div></div>')),t.addClass("button-disabled"),t.parent().append('<span class="spinner is-active"></span>'),i.process_step(1,r)}}).on("submit",".pum-batch-form.pum-upgrade-form[data-upgrade_id]",function(a){var e=o(this),t={upgrade_id:e.data("upgrade_id"),nonce:e.data("nonce"),form:e.serializeAssoc(),test:e.pumSerializeObject()};a.preventDefault(),s.form.beforeSubmit(e)&&s.process_step(e.data("step")||1,t)}).ready(function(){})}(jQuery),jQuery(document).ready(function(o){o.extend({arrayMerge:function(){for(var a={},e=0,t=o.arrayMerge.arguments,s=0;s<t.length;s++)if(Array.isArray(t[s])){for(var r=0;r<t[s].length;r++)a[e++]=t[s][r];a=o.makeArray(a)}else for(var n in t[s])if(t[s].hasOwnProperty(n))if(isNaN(n)){var d=t[s][n];"object"==typeof d&&a[n]&&(d=o.arrayMerge(a[n],d)),a[n]=d}else a[e++]=t[s][n];return a},count:function(a){return Array.isArray(a)?a.length:"object"==typeof a&&Object.keys(a).length}}),o.fn.extend({serializeAssoc:function(){for(var a={aa:{},add:function(a,e){var t=a.match(/^(.*)\[([^\]]*)]$/),s={};t?(t[2]?s[t[2]]=e:s[o.count(s)]=e,this.add(t[1],s)):"object"==typeof e?("object"!=typeof this.aa[a]&&(this.aa[a]={}),this.aa[a]=o.arrayMerge(this.aa[a],e)):this.aa[a]=e}},e=o(this).serializeArray(),t=0;t<e.length;t++)a.add(e[t].name,e[t].value);return a.aa}})});