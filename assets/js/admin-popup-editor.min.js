!function(e,t,n){"use strict";e(t).on("click","#popup_reset_open_count",function(){var t=e(this);t.is(":checked")&&!confirm(pum_admin_vars.I10n.confirm_count_reset)&&t.prop("checked",!1)})}(jQuery,document),function(e){"use strict";var t={get_conditions:function(){return window.pum_popup_settings_editor.conditions_selectlist},not_operand_checkbox:function(n){return n=n||e(".pum-not-operand"),n.each(function(){var n=e(this),i=n.find("input");i.prop("checked",!i.is(":checked")),t.toggle_not_operand(n)})},toggle_not_operand:function(t){return t=t||e(".pum-not-operand"),t.each(function(){var t=e(this),n=t.find("input"),i=t.parents(".facet-target");n.is(":checked")?i.addClass("not-operand-checked"):i.removeClass("not-operand-checked")})},template:{editor:function(t){var n=e.extend(!0,{},{groups:[]},t);return n.groups=PUM_Admin.utils.object_to_array(n.groups),PUM_Admin.templates.render("pum-condition-editor",n)},group:function(t){var n,i=e.extend(!0,{},{index:"",facets:[]},t);for(i.facets=PUM_Admin.utils.object_to_array(i.facets),n=0;i.facets.length>n;n++)i.facets[n].index=n,i.facets[n].group=i.index;return PUM_Admin.templates.render("pum-condition-group",i)},facet:function(t){var n=e.extend(!0,{},{group:"",index:"",target:"",not_operand:!1,settings:{}},t);return PUM_Admin.templates.render("pum-condition-facet",n)},settings:function(t,n){var i=[],r=e.extend(!0,{},{index:"",group:"",target:null,fields:[]},t);return r.fields.length||void 0===pum_popup_settings_editor.conditions[t.target]||(r.fields=pum_popup_settings_editor.conditions[t.target].fields),void 0===n&&(n={}),_.each(r.fields,function(e,t){e=PUM_Admin.models.field(e),"object"!=typeof e.meta&&(e.meta={}),void 0!==n[t]&&(e.value=n[t]),e.name="popup_settings[conditions]["+r.group+"]["+r.index+"][settings]["+t+"]",""===e.id&&(e.id="popup_settings_conditions_"+r.group+"_"+r.index+"_settings_"+t),i.push(PUM_Admin.templates.field(e))}),PUM_Admin.templates.section({fields:i})},selectbox:function(n){var i=e.extend(!0,{},{id:null,name:null,type:"select",group:"",index:"",value:null,select2:!0,classes:[],options:t.get_conditions()},n);return null===i.id&&(i.id="popup_settings_conditions_"+i.group+"_"+i.index+"_target"),null===i.name&&(i.name="popup_settings[conditions]["+i.group+"]["+i.index+"][target]"),PUM_Admin.templates.field(i)}},groups:{add:function(n,i,r){var o=e(n),s={index:o.find(".facet-group-wrap").length,facets:[{target:i||null,not_operand:r||!1,settings:{}}]};o.find(".facet-groups").append(t.template.group(s)),o.addClass("has-conditions")},remove:function(n){var i=n.parents(".facet-builder");n.prev(".facet-group-wrap").find(".and .add-facet").removeClass("disabled"),n.remove(),t.renumber(),0===i.find(".facet-group-wrap").length&&(i.removeClass("has-conditions"),e("#pum-first-condition").val(null).trigger("change"))}},facets:{add:function(e,n,i){var r={group:e.data("index"),index:e.find(".facet").length,target:n||null,not_operand:i||!1,settings:{}};e.find(".facet-list").append(t.template.facet(r))},remove:function(e){var n=e.parents(".facet-group-wrap");e.remove(),0===n.find(".facet").length?t.groups.remove(n):t.renumber()}},renumber:function(){e(".facet-builder .facet-group-wrap").each(function(){var t=e(this),n=t.parent().children().index(t);t.data("index",n).find(".facet").each(function(){var t=e(this),i=t.parent().children().index(t);t.data("index",i).find("[name]").each(function(){this.name=this.name.replace(/popup_settings\[conditions\]\[\d*?\]\[\d*?\]/,"popup_settings[conditions]["+n+"]["+i+"]"),this.id=this.id.replace(/popup_settings_conditions_\d*?_\d*?_/,"popup_settings_conditions_"+n+"_"+i+"_")})})})}};window.PUM_Admin=window.PUM_Admin||{},window.PUM_Admin.conditions=t,e(document).on("pum_init",function(){t.renumber(),t.toggle_not_operand()}).on("select2:select pumselect2:select","#pum-first-condition",function(n){var i=e(this),r=i.parents(".facet-builder").eq(0),o=i.val(),s=r.find("#pum-first-facet-operand"),d=s.is(":checked");t.groups.add(r,o,d),i.val(null).trigger("change"),s.prop("checked",!1).parents(".facet-target").removeClass("not-operand-checked"),e(document).trigger("pum_init")}).on("click",".facet-builder .pum-not-operand",function(){t.not_operand_checkbox(e(this))}).on("change",".facet-builder .facet-target select",function(n){var i=e(this),r=i.parents(".facet"),o=i.val(),s={target:o};""!==o&&o!==r.data("target")&&(r.data("target",o).find(".facet-settings").html(t.template.settings(s)),e(document).trigger("pum_init"))}).on("click",".facet-builder .facet-group-wrap:last-child .and .add-facet",function(){t.groups.add(e(this).parents(".facet-builder").eq(0)),e(document).trigger("pum_init")}).on("click",".facet-builder .add-or .add-facet:not(.disabled)",function(){t.facets.add(e(this).parents(".facet-group-wrap").eq(0)),e(document).trigger("pum_init")}).on("click",".facet-builder .remove-facet",function(){t.facets.remove(e(this).parents(".facet").eq(0)),e(document).trigger("pum_init")})}(jQuery);var cookies;!function(e,t,n){"use strict";var i,r=pum_admin_vars.I10n,o={get_cookies:function(){return window.pum_popup_settings_editor.cookies},get_cookie:function(e){var t=this.get_cookies(),n="undefined"!==t[e]&&t[e];return!!n&&(n&&"object"==typeof n&&"object"==typeof n.fields&&Object.keys(n.fields).length&&(n=this.parseFields(n)),n)},parseFields:function(e){return _.each(e.fields,function(t,n){_.each(t,function(t,i){e.fields[n][i].name="cookie_settings["+i+"]",""===e.fields[n][i].id&&(e.fields[n][i].id="cookie_settings_"+i)})}),e},parseValues:function(e,t){return e},select_list:function(){var e,t=PUM_Admin.utils.object_to_array(o.get_cookies()),n={};for(e=0;e<t.length;e++)n[t[e].id]=t[e].name;return n},getLabel:function(e){var t=o.get_cookie(e);return!!t&&t.name},getSettingsDesc:function(e,t){var n=o.get_cookie(e);return!!n&&PUM_Admin.templates.renderInline(n.settings_column,t)},refreshDescriptions:function(){e(".pum-popup-cookie-editor table.list-table tbody tr").each(function(){var t=e(this),n=t.find(".popup_cookies_field_event").val(),i=JSON.parse(t.find(".popup_cookies_field_settings:first").val());t.find("td.settings-column").html(o.getSettingsDesc(n,i))})},insertDefault:function(t,n){o.rows.add(t,{event:"on_popup_close",settings:{name:n||"pum-"+e("#post_ID").val()}})},template:{form:function(t,n,i){var s=o.get_cookie(t),d="pum_cookie_settings",a=Object.keys(s.fields)[0];n=n||{},n.event=t,n.index=n.index>=0?n.index:null,s.fields[a]=e.extend(!0,s.fields[a],{index:{type:"hidden",name:"index"},event:{type:"hidden",name:"event"}}),"string"==typeof n.key&&""!==n.key||delete s.fields.advanced.key,PUM_Admin.modals.reload("#"+d,PUM_Admin.templates.modal({id:d,title:s.modal_title||s.name,classes:"tabbed-content",save_button:null!==n.index?r.update:r.add,content:PUM_Admin.forms.render({id:"pum_cookie_settings_form",tabs:s.tabs||{},fields:s.fields||{}},n||{})})),e("#"+d+" form").on("submit",i||function(e){e.preventDefault(),PUM_Admin.modals.closeAll()})},editor:function(t){var n=e.extend(!0,{},{cookies:[],name:""},t);return n.cookies=PUM_Admin.utils.object_to_array(n.cookies),PUM_Admin.templates.render("pum-cookie-editor",n)},row:function(t){var n=e.extend(!0,{},{index:"",event:"",name:"",settings:{name:"",key:"",session:!1,time:"30 days",path:!0}},t);return PUM_Admin.templates.render("pum-cookie-row",n)},selectbox:function(t){var n=e.extend(!0,{},{id:null,name:null,type:"select",group:"",index:"",value:null,select2:!0,classes:[],options:o.select_list()},t);return null===n.id&&(n.id="popup_settings_cookies_"+n.index+"_event"),null===n.name&&(n.name="popup_settings[cookies]["+n.index+"][event]"),PUM_Admin.templates.field(n)}},rows:{add:function(t,n){var i=e(t),r={index:null!==n.index&&n.index>=0?n.index:i.find("table.list-table tbody tr").length,event:n.event,name:i.data("field_name"),settings:n.settings||{}},s=i.find("tbody tr").eq(r.index),d=PUM_Admin.templates.render("pum-cookie-row",r);s.length?s.replaceWith(d):i.find("tbody").append(d),i.addClass("has-list-items"),o.rows.renumber(),o.refreshDescriptions()},remove:function(t){var n=t.parents(".pum-popup-cookie-editor");t.remove(),o.rows.renumber(),0===n.find("table.list-table tbody tr").length&&(n.removeClass("has-list-items"),e("#pum-first-cookie").val(null).trigger("change"))},renumber:function(){e(".pum-popup-cookie-editor table.list-table tbody tr").each(function(){var t=e(this),n=t.parent().children().index(t);t.attr("data-index",n).data("index",n),t.find(":input, [name]").each(function(){this.name&&""!==this.name&&(this.name=this.name.replace(/\[\d*?\]/,"["+n+"]"))})})}}};window.PUM_Admin=window.PUM_Admin||{},window.PUM_Admin.cookies=o,e(t).on("pum_init",function(){o.refreshDescriptions()}).on("select2:select pumselect2:select","#pum-first-cookie",function(){var t=e(this),n=t.parents(".pum-popup-cookie-editor"),i=t.val(),r={name:"pum-"+e("#post_ID").val()};t.val(null).trigger("change"),o.template.form(i,r,function(t){var i=e(this),r=i.find("input#event").val(),s=i.find("input#index").val(),d=i.pumSerializeObject();t.preventDefault(),(!s||s<0)&&(s=n.find("tbody tr").length),o.rows.add(n,{index:s,event:r,settings:d.cookie_settings}),PUM_Admin.modals.closeAll()})}).on("click",".pum-popup-cookie-editor .pum-add-new",function(){i=e(this).parents(".pum-popup-cookie-editor");var t=wp.template("pum-cookie-add-event");PUM_Admin.modals.reload("#pum_cookie_add_event_modal",t({I10n:r}))}).on("click",".pum-popup-cookie-editor .edit",function(t){var n=e(this),i=n.parents(".pum-popup-cookie-editor"),r=n.parents("tr:first"),s=r.find(".popup_cookies_field_event").val(),d=_.extend({},JSON.parse(r.find(".popup_cookies_field_settings:first").val()),{index:r.parent().children().index(r),event:s});t.preventDefault(),o.template.form(s,d,function(t){var n=e(this),r=n.find("input#event").val(),s=n.find("input#index").val(),d=n.pumSerializeObject();t.preventDefault(),(!s||s<0)&&(s=i.find("tbody tr").length),o.rows.add(i,{index:s,event:r,settings:d.cookie_settings}),PUM_Admin.modals.closeAll()})}).on("click",".pum-popup-cookie-editor .remove",function(t){var n=e(this),i=n.parents("tr:first");t.preventDefault(),window.confirm(r.confirm_delete_cookie)&&o.rows.remove(i)}).on("click",".pum-field-cookie_key button.reset",function(t){var n=e(this),i=(new Date).getTime().toString(16);n.siblings('input[type="text"]:first').val(i)}).on("submit","#pum_cookie_add_event_modal .pum-form",function(t){var n=i,r=e("#popup_cookie_add_event").val(),s={name:"pum-"+e("#post_ID").val()};t.preventDefault(),o.template.form(r,s,function(t){var i=e(this),r=i.find("input#event").val(),s=i.find("input#index").val(),d=i.pumSerializeObject();if(t.preventDefault(),(!s||s<0)&&(s=n.find("tbody tr").length),o.rows.add(n,{index:s,event:r,settings:d.cookie_settings}),PUM_Admin.modals.closeAll(),"undefined"!=typeof PUM_Admin.triggers&&PUM_Admin.triggers.new_cookie!==!1&&PUM_Admin.triggers.new_cookie>=0){var a=PUM_Admin.triggers.current_editor.find("tbody tr").eq(PUM_Admin.triggers.new_cookie).find(".popup_triggers_field_settings:first"),p=JSON.parse(a.val());"string"==typeof p.cookie_name?p.cookie_name=p.cookie_name.replace("add_new",d.cookie_settings.name):p.cookie_name[p.cookie_name.indexOf("add_new")]=d.cookie_settings.name,a.val(JSON.stringify(p)),PUM_Admin.triggers.new_cookie=!1,PUM_Admin.triggers.refreshDescriptions()}})})}(jQuery,document),function(e,t,n){"use strict";var i=pum_admin_vars.I10n,r={current_editor:null,new_cookie:!1,get_triggers:function(){return window.pum_popup_settings_editor.triggers},get_trigger:function(e){var t=this.get_triggers(),i="undefined"!==t[e]&&t[e];return!!i&&(i.updated=i.updated!==n&&i.updated,i&&"object"==typeof i&&"object"==typeof i.fields&&Object.keys(i.fields).length&&(i=this.parseFields(i)),i)},parseFields:function(e){return _.each(e.fields,function(t,n){_.each(t,function(t,i){e.fields[n][i].name="trigger_settings["+i+"]",""===e.fields[n][i].id&&(e.fields[n][i].id="trigger_settings_"+i)})}),e},parseValues:function(e,t){return e},select_list:function(){var e,t=PUM_Admin.utils.object_to_array(r.get_triggers()),n={};for(e=0;e<t.length;e++)n[t[e].id]=t[e].name;return n},rows:{add:function(t,n){var i=e(t),o={index:null!==n.index&&n.index>=0?n.index:i.find("table.list-table tbody tr").length,type:n.type,name:i.data("field_name"),settings:n.settings||{}},s=i.find("tbody tr").eq(o.index),d=PUM_Admin.templates.render("pum-trigger-row",o);s.length?s.replaceWith(d):i.find("tbody").append(d),i.addClass("has-list-items"),r.renumber(),r.refreshDescriptions()},remove:function(t){var n=t.parents(".pum-popup-trigger-editor");t.remove(),r.renumber(),0===n.find("table.list-table tbody tr").length&&(n.removeClass("has-list-items"),e("#pum-first-trigger").val(null).trigger("change"))}},template:{form:function(t,n,o){var s=r.get_trigger(t),d="pum_trigger_settings",a=Object.keys(s.fields)[0],p=e("#pum_popup_cookies_list tbody tr");n=n||{},n.type=t,n.index=n.index>=0?n.index:null,s.fields[a]=e.extend(!0,s.fields[a],{index:{type:"hidden",name:"index"},type:{type:"hidden",name:"type"}}),p.length||"click_open"===t||(PUM_Admin.cookies.insertDefault(),p=e("#pum_popup_cookies_list tbody tr")),p.each(function(){var t=JSON.parse(e(this).find(".popup_cookies_field_settings:first").val());"undefined"==typeof s.fields[a].cookie_name.options[t.name]&&(s.fields[a].cookie_name.options[t.name]=t.name)}),PUM_Admin.modals.reload("#"+d,PUM_Admin.templates.modal({id:d,title:s.modal_title||s.name,classes:"tabbed-content",save_button:null!==n.index?i.update:i.add,content:PUM_Admin.forms.render({id:"pum_trigger_settings_form",tabs:s.tabs||{},fields:s.fields||{}},n||{})})),e("#"+d+" form").on("submit",o||function(e){e.preventDefault(),PUM_Admin.modals.closeAll()})},editor:function(t){var n=e.extend(!0,{},{triggers:[],name:""},t);return n.triggers=PUM_Admin.utils.object_to_array(n.triggers),PUM_Admin.templates.render("pum-trigger-editor",n)},row:function(t){var n=e.extend(!0,{},{index:"",type:"",name:"",settings:{cookie_name:""}},t);return PUM_Admin.templates.render("pum-trigger-row",n)},selectbox:function(t){var n=e.extend(!0,{},{id:null,name:null,type:"select",group:"",index:"",value:null,select2:!0,classes:[],options:r.select_list()},t);return null===n.id&&(n.id="popup_settings_triggers_"+n.index+"_type"),null===n.name&&(n.name="popup_settings[triggers]["+n.index+"][type]"),PUM_Admin.templates.field(n)}},getLabel:function(e){var t=r.get_trigger(e);return!!t&&t.name},getSettingsDesc:function(e,t){var n=r.get_trigger(e);return!!n&&PUM_Admin.templates.renderInline(n.settings_column,t)},renumber:function(){e(".pum-popup-trigger-editor table.list-table tbody tr").each(function(){var t=e(this),n=t.parent().children().index(t);t.attr("data-index",n).data("index",n),t.find(":input, [name]").each(function(){this.name&&""!==this.name&&(this.name=this.name.replace(/\[\d*?\]/,"["+n+"]"))})})},refreshDescriptions:function(){e(".pum-popup-trigger-editor table.list-table tbody tr").each(function(){var t=e(this),n=t.find(".popup_triggers_field_type").val(),i=JSON.parse(t.find(".popup_triggers_field_settings:first").val()),r=PUM_Admin.triggers.cookie_column_value(i.cookie_name);t.find("td.settings-column").html(PUM_Admin.triggers.getSettingsDesc(n,i)),t.find("td.cookie-column code").text(r)})},cookie_column_value:function(e){var t=i.no_cookie;return e instanceof Array?t=e.join(", "):null!==e&&(t=e),t},append_click_selector_presets:function(){var t,n,i=e("#extra_selectors");i.length&&!i.hasClass("pum-click-selector-presets-initialized")&&(t=PUM_Admin.templates.render("pum-click-selector-presets"),n=i.parents(".pum-field").find(".pum-click-selector-presets"),n.length||(i.before(t),i.addClass("pum-click-selector-presets-initialized"),n=i.parents(".pum-field").find(".pum-click-selector-presets")),n.position({my:"right center",at:"right center",of:i}))},toggle_click_selector_presets:function(){e(this).parent().toggleClass("open")},reset_click_selector_presets:function(t){t!==n&&e(t.target).parents(".pum-click-selector-presets").length||e(".pum-click-selector-presets").removeClass("open")},insert_click_selector_preset:function(){var t=e(this),n=e("#extra_selectors"),i=n.val();""!==i&&(i+=", "),n.val(i+t.data("preset")),PUM_Admin.triggers.reset_click_selector_presets()}};window.PUM_Admin=window.PUM_Admin||{},window.PUM_Admin.triggers=r,e(t).on("pum_init",function(){PUM_Admin.triggers.append_click_selector_presets(),PUM_Admin.triggers.refreshDescriptions()}).on("click",".pum-click-selector-presets > span",PUM_Admin.triggers.toggle_click_selector_presets).on("click",".pum-click-selector-presets li",PUM_Admin.triggers.insert_click_selector_preset).on("click",PUM_Admin.triggers.reset_click_selector_presets).on("select2:select pumselect2:select","#pum-first-trigger",function(){var t=e(this),i=t.parents(".pum-popup-trigger-editor"),o=t.val(),s={};PUM_Admin.triggers.current_editor=i,"click_open"!==o&&(s.cookie_name="pum-"+e("#post_ID").val()),r.template.form(o,s,function(t){var o=e(this),s=o.find("input#type").val(),d=o.pumSerializeObject(),a=parseInt(d.index);t.preventDefault(),(!a||a<0)&&(a=i.find("tbody tr").length),r.rows.add(i,{index:a,type:s,settings:d.trigger_settings}),PUM_Admin.modals.closeAll(),d.trigger_settings.cookie_name!==n&&null!==d.trigger_settings.cookie_name&&("add_new"===d.trigger_settings.cookie_name||d.trigger_settings.cookie_name.indexOf("add_new")>=0)&&(PUM_Admin.triggers.new_cookie=d.index,e("#pum-popup-settings-container .pum-popup-cookie-editor button.pum-add-new").trigger("click"))}),t.val(null).trigger("change")}).on("click",".pum-popup-trigger-editor .pum-add-new",function(){PUM_Admin.triggers.current_editor=e(this).parents(".pum-popup-trigger-editor");var t=wp.template("pum-trigger-add-type");PUM_Admin.modals.reload("#pum_trigger_add_type_modal",t({I10n:i}))}).on("click",".pum-popup-trigger-editor .edit",function(t){var i=e(this),o=i.parents(".pum-popup-trigger-editor"),s=i.parents("tr:first"),d=s.find(".popup_triggers_field_type").val(),a=_.extend({},JSON.parse(s.find(".popup_triggers_field_settings:first").val()),{index:s.parent().children().index(s),type:d});t.preventDefault(),r.template.form(d,a,function(t){var i=e(this),s=i.find("input#type").val(),d=i.find("input#index").val(),a=i.pumSerializeObject();PUM_Admin.triggers.current_editor=o,t.preventDefault(),(!d||d<0)&&(d=o.find("tbody tr").length),r.rows.add(o,{index:d,type:s,settings:a.trigger_settings}),PUM_Admin.modals.closeAll(),a.trigger_settings.cookie_name!==n&&null!==a.trigger_settings.cookie_name&&("add_new"===a.trigger_settings.cookie_name||a.trigger_settings.cookie_name.indexOf("add_new")>=0)&&(PUM_Admin.triggers.new_cookie=a.index,e("#pum-popup-settings-container .pum-popup-cookie-editor button.pum-add-new").trigger("click"))})}).on("click",".pum-popup-trigger-editor .remove",function(t){var n=e(this),o=n.parents(".pum-popup-trigger-editor"),s=n.parents("tr:first");PUM_Admin.triggers.current_editor=o,t.preventDefault(),window.confirm(i.confirm_delete_trigger)&&r.rows.remove(s)}).on("submit","#pum_trigger_add_type_modal .pum-form",function(t){var i=PUM_Admin.triggers.current_editor,o=e("#popup_trigger_add_type").val(),s={};t.preventDefault(),"click_open"!==o&&(s.cookie_name="pum-"+e("#post_ID").val()),r.template.form(o,s,function(t){var o=e(this),s=o.find("input#type").val(),d=o.pumSerializeObject(),a=parseInt(d.index);PUM_Admin.triggers.current_editor=i,t.preventDefault(),(!a||a<0)&&(a=i.find("tbody tr").length),r.rows.add(i,{index:a,type:s,settings:d.trigger_settings}),PUM_Admin.modals.closeAll(),d.trigger_settings.cookie_name!==n&&null!==d.trigger_settings.cookie_name&&("add_new"===d.trigger_settings.cookie_name||d.trigger_settings.cookie_name.indexOf("add_new")>=0)&&(PUM_Admin.triggers.new_cookie=d.index,e("#pum-popup-settings-container .pum-popup-cookie-editor button.pum-add-new").trigger("click"))})})}(jQuery,document),function(e){"use strict";window.PUM_Admin=window.PUM_Admin||{},window.pum_popup_settings_editor=window.pum_popup_settings_editor||{form_args:{},current_values:{}},e(document).ready(function(){e(this).trigger("pum_init"),e("#title").prop("required",!0);var t=e("#pum-popup-settings-container"),n=pum_popup_settings_editor.form_args||{},i=pum_popup_settings_editor.current_values||{};t.length&&PUM_Admin.forms.render(n,i,t)}).on("keydown","#popup-title",function(t){var n=t.keyCode||t.which;9===n&&(t.preventDefault(),e("#title").focus())}).on("keydown","#title, #popup-title",function(t){var n,i=t.keyCode||t.which;t.shiftKey||9!==i||(t.preventDefault(),n="title"===e(this).attr("id")?"#popup-title":"#insert-media-button",e(n).focus())}).on("keydown","#popup-title, #insert-media-button",function(t){var n,i=t.keyCode||t.which;t.shiftKey&&9===i&&(t.preventDefault(),n="popup-title"===e(this).attr("id")?"#title":"#popup-title",e(n).focus())})}(jQuery);