(()=>{var t={2639:()=>{!function(t){"use strict";function n(){const n=t("#popup_maker_pro_license_key");0!==n.length&&(n.each(function(){const n=t(this);if(!n.length)return;const e=n.closest(".pum-license-input-group").find(".pum-license-activate, .button-primary");function o(){const t=n.val().trim();e.length&&(32===t.length?e.prop("disabled",!1):e.prop("disabled",!0))}n.on("paste",function(){setTimeout(function(){0!==n.val().trim().length&&(o(),e.length&&!e.prop("disabled")&&e.trigger("click"))},100)}),n.on("input keyup",function(){o()}),n.on("keypress",function(t){if(13===t.which||13===t.keyCode){if(t.preventDefault(),o(),0===n.val().trim().length)return;e.length&&!e.prop("disabled")&&e.trigger("click")}}),o()}),function(){const n=t("#popup_maker_pro_license_key").closest(".pum-field");if(!n.length)return;if(0===t("#popup_maker_pro_license_key").val().trim().length){const e=t('\n\t\t\t\t<div class="pum-upgrade-flow-container">\n\t\t\t\t\t<p class="pum-upgrade-prompt">\n\t\t\t\t\t\tDon\'t have a license yet? \n\t\t\t\t\t\t<button type="button" class="button button-secondary pum-pro-upgrade-trigger" \n\t\t\t\t\t\t\t\tdata-product="popup-maker-pro" \n\t\t\t\t\t\t\t\tdata-source="license-section" \n\t\t\t\t\t\t\t\tdata-campaign="no-license">\n\t\t\t\t\t\t\tGet Popup Maker Pro\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t');n.append(e)}const e=t('\n\t\t\t<div class="pum-license-connect-container">\n\t\t\t\t<p class="pum-connect-prompt">\n\t\t\t\t\tAlready have a license? \n\t\t\t\t\t<button type="button" class="button button-primary pum-license-connect-trigger" \n\t\t\t\t\t\t\tdata-product="popup-maker-pro" \n\t\t\t\t\t\t\tdata-source="license-section" \n\t\t\t\t\t\t\tdata-campaign="existing-license">\n\t\t\t\t\t\tConnect License\n\t\t\t\t\t</button>\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t');n.append(e)}(),t(document).on("pum_license_connected",e),t(document).on("pum_license_status_changed",o),t(document).on("pum_install_pro_plugin",i),t(document).on("pum_license_connection_error",s),t("#popup_maker_pro_license_key").on("input change",a),t("#pum-license-loading-styles").length||t("head").append("\n\t\t\t\t<style id=\"pum-license-loading-styles\">\n\t\t\t\t\t.pum-license-loading {\n\t\t\t\t\t\tposition: relative;\n\t\t\t\t\t\topacity: 0.6;\n\t\t\t\t\t\tpointer-events: none;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t.pum-license-loading::after {\n\t\t\t\t\t\tcontent: '';\n\t\t\t\t\t\tposition: absolute;\n\t\t\t\t\t\ttop: 50%;\n\t\t\t\t\t\tleft: 50%;\n\t\t\t\t\t\twidth: 20px;\n\t\t\t\t\t\theight: 20px;\n\t\t\t\t\t\tmargin: -10px 0 0 -10px;\n\t\t\t\t\t\tborder: 2px solid #f3f3f3;\n\t\t\t\t\t\tborder-top: 2px solid #007cba;\n\t\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\t\tanimation: pum-spin 1s linear infinite;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t@keyframes pum-spin {\n\t\t\t\t\t\t0% { transform: rotate(0deg); }\n\t\t\t\t\t\t100% { transform: rotate(360deg); }\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t.pum-upgrade-flow-container,\n\t\t\t\t\t.pum-license-connect-container {\n\t\t\t\t\t\tmargin-top: 10px;\n\t\t\t\t\t\tpadding: 10px;\n\t\t\t\t\t\tbackground: #f9f9f9;\n\t\t\t\t\t\tborder-left: 4px solid #007cba;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t.pum-upgrade-prompt,\n\t\t\t\t\t.pum-connect-prompt {\n\t\t\t\t\t\tmargin: 0;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t.pum-license-status {\n\t\t\t\t\t\tmargin-top: 5px;\n\t\t\t\t\t\tpadding: 5px 10px;\n\t\t\t\t\t\tborder-radius: 3px;\n\t\t\t\t\t\tfont-size: 12px;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t.pum-license-status.valid {\n\t\t\t\t\t\tbackground: #d4edda;\n\t\t\t\t\t\tcolor: #155724;\n\t\t\t\t\t\tborder: 1px solid #c3e6cb;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t.pum-license-status.invalid {\n\t\t\t\t\t\tbackground: #f8d7da;\n\t\t\t\t\t\tcolor: #721c24;\n\t\t\t\t\t\tborder: 1px solid #f5c6cb;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t.pum-popup-open {\n\t\t\t\t\t\tposition: relative;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t.pum-popup-open::after {\n\t\t\t\t\t\tcontent: 'Opening license connection...';\n\t\t\t\t\t\tposition: absolute;\n\t\t\t\t\t\ttop: 0;\n\t\t\t\t\t\tleft: 0;\n\t\t\t\t\t\tright: 0;\n\t\t\t\t\t\tbottom: 0;\n\t\t\t\t\t\tbackground: rgba(255, 255, 255, 0.9);\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\tjustify-content: center;\n\t\t\t\t\t\tfont-size: 12px;\n\t\t\t\t\t\tcolor: #666;\n\t\t\t\t\t}\n\t\t\t\t</style>\n\t\t\t"),function(){if(window.PUM_Admin.LicenseStatusPolling)return;const n=setInterval(function(){!function(){const n=t("#popup_maker_pro_license_key").val().trim();32===n.length&&t.ajax({url:window.ajaxurl||"/wp-admin/admin-ajax.php",type:"POST",data:{action:"pum_check_license_status",license_key:n,nonce:window.pum_admin_vars?.nonce||""},success:function(t){t.success&&t.data&&r(t.data)},error:function(){console.log("License status check failed")}})}()},3e4);t(window).on("beforeunload",function(){clearInterval(n)})}())}function e(n,e){if(console.log("License key enhancements: License connected",e),e.license_key){const n=t("#popup_maker_pro_license_key");n.val(e.license_key),n.trigger("change")}p("License connected successfully!","success"),r(e),l()}function o(t,n){console.log("License key enhancements: License status changed",n),r(n),n.is_valid?p("License activated successfully!","success"):n.status&&p(`License status: ${n.status}`,"info")}function i(n,e){console.log("License key enhancements: Pro installation triggered",e),p("Installing Popup Maker Pro...","info"),t("#popup_maker_pro_license_key").closest(".pum-field").addClass("pum-license-loading")}function s(n,e){console.error("License key enhancements: License error",e),p(e.error||"License connection failed","error"),t("#popup_maker_pro_license_key").closest(".pum-field").removeClass("pum-license-loading")}function a(){const n=t(this).val().trim();0===n.length?t(".pum-upgrade-flow-container, .pum-license-connect-container").show():l(),function(n){32===n.length?t(".pum-license-status").length||t("#popup_maker_pro_license_key").after('<div class="pum-license-status">Ready to activate</div>'):t(".pum-license-status").remove()}(n)}function r(n){!function(n){let e=t(".pum-license-status");e.length||(e=t('<div class="pum-license-status"></div>'),t("#popup_maker_pro_license_key").after(e)),e.removeClass("valid invalid"),n.is_valid?(e.addClass("valid"),e.html(`\n\t\t\t\t<span class="pum-license-status-text">✓ License Valid</span>\n\t\t\t\t${n.expires?`<span class="pum-license-expires"> (Expires: ${n.expires})</span>`:""}\n\t\t\t`)):(e.addClass("invalid"),e.html(`\n\t\t\t\t<span class="pum-license-status-text">✗ ${n.status||"Invalid License"}</span>\n\t\t\t`))}(n),function(n){const e=t(".pum-license-activate, .button-primary");e.length&&(n.is_valid?e.text("Deactivate").removeClass("button-primary").addClass("button-secondary"):e.text("Activate").removeClass("button-secondary").addClass("button-primary"))}(n),n.is_valid&&l()}function l(){t(".pum-upgrade-flow-container, .pum-license-connect-container").hide()}function p(t,n){window.PUM_Admin.ProUpgradeFlow&&window.PUM_Admin.ProUpgradeFlow.showMessage?window.PUM_Admin.ProUpgradeFlow.showMessage(t,n):console.log(`License: [${n.toUpperCase()}] ${t}`)}window.PUM_Admin=window.PUM_Admin||{},t(function(){n()}),t(document).on("pum_init",function(){n()})}(jQuery)},6229:()=>{!function(t){"use strict";window.PUM_Admin=window.PUM_Admin||{},window.PUM_Admin.ProUpgradeFlow={};const n={popupWindow:null,isMonitoring:!1,monitorInterval:null,isInitialized:!1,popupConfig:{width:580,height:600,name:"popup-maker-license-connect",features:"toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no"},init:function(){this.isInitialized?console.log("Pro Upgrade Flow already initialized, skipping"):(console.log("Initializing Pro Upgrade Flow"),this.isInitialized=!0,this.bindEvents())},bindEvents:function(){t(document).on("click",".pum-pro-upgrade-trigger, .pum-license-connect-trigger",this.handleUpgradeClick.bind(this)),t(window).on("focus",this.handleWindowFocus.bind(this)),t(window).on("beforeunload",this.cleanup.bind(this))},handleUpgradeClick:async function(n){n.preventDefault();const e=t(n.currentTarget);try{e.prop("disabled",!0).text("Opening upgrade window..."),this.openLoadingPopup();const t=await this.extractConnectInfo(e);if(!this.validateConnectInfo(t))return console.error("Invalid connection info:",t),this.showError("Invalid connection parameters. Please try again."),void this.closePopup();this.navigatePopupToFinalUrl(t)}catch(t){console.error("Error getting connection info:",t),this.showError("Failed to prepare connection. Please try again."),this.closePopup()}finally{e.prop("disabled",!1).text(e.hasClass("pum-pro-upgrade-trigger")?"Get Popup Maker Pro":"Connect License")}},extractConnectInfo:async function(n){const e=t("#popup_maker_pro_license_key"),o=e.length?e.val().trim():"",i={product:n.data("product")||"popup-maker-pro",source:n.data("source")||"settings-page",campaign:n.data("campaign")||"upgrade-flow",existing_license:o};try{const n=await t.ajax({url:window.location.origin+"/wp-json/popup-maker/v2/license/connect-info",type:"GET",data:{license_key:o,context:JSON.stringify(i)},headers:{"X-WP-Nonce":window.pum_admin_vars?.rest_nonce||window.wpApiSettings?.nonce||""}});if(n.success&&n.data)return console.log("Got server-generated connection info:",n.data),n.data;throw new Error(n.data?.message||"Failed to get connection info")}catch(t){return console.error("Failed to get server connection info:",t),console.warn("Using fallback client-side connection info - may not work properly"),{site_url:window.location.origin||"",admin_url:window.ajaxurl?window.ajaxurl.replace("admin-ajax.php",""):"",return_url:window.location.href,product:i.product,source:i.source,campaign:i.campaign,existing_license:i.existing_license,nonce:window.pum_admin_vars?.nonce||window.pum_settings_editor?.nonce||""}}},validateConnectInfo:function(t){return["key","token","nonce","full_url"].every(n=>{const e=t[n];return e&&"string"==typeof e&&e.trim().length>0})},openLicensePopup:function(t){this.closePopup();const n=this.buildPopupUrl(t),e=Math.round((screen.width-this.popupConfig.width)/2),o=Math.round((screen.height-this.popupConfig.height)/2),i=`${this.popupConfig.features},width=${this.popupConfig.width},height=${this.popupConfig.height},left=${e},top=${o}`;if(console.log("Opening license popup:",n),console.log("Popup config:",{name:this.popupConfig.name,features:i}),this.popupWindow=window.open(n,this.popupConfig.name,i),console.log("Popup window result:",this.popupWindow),!this.popupWindow)return console.error("Failed to open popup window - likely blocked by browser"),void this.showError("Popup blocked! Please allow popups for this site and try again.");try{if(this.popupWindow.closed)return console.error("Popup window was immediately closed"),this.showError("Popup was blocked or closed. Please allow popups for this site."),void(this.popupWindow=null)}catch(t){console.log("Cannot access popup window properties (normal for cross-origin):",t.message)}this.startPopupMonitoring(),this.showPopupOpenState()},buildPopupUrl:function(t){if(t.full_url)return console.log("Using server-generated full URL:",t.full_url),t.full_url;const n=t.base_url||"https://upgrade.wppopupmaker.com",e=new URLSearchParams,o=["product","source","campaign","base_url","full_url","back_url","existing_license"];Object.keys(t).forEach(n=>{t[n]&&!o.includes(n)&&e.append(n,t[n])});const i=`${n}?${e.toString()}`;return console.log("Built fallback URL from parameters:",i),i},openLoadingPopup:function(){this.popupWindow&&!this.popupWindow.closed&&this.popupWindow.close(),this.popupWindow=null;const t=Math.round((screen.width-this.popupConfig.width)/2),n=Math.round((screen.height-this.popupConfig.height)/2),e=`${this.popupConfig.features},width=${this.popupConfig.width},height=${this.popupConfig.height},left=${t},top=${n}`,o="data:text/html;charset=utf-8,"+encodeURIComponent('\n\t\t\t\t<!DOCTYPE html>\n\t\t\t\t<html>\n\t\t\t\t<head>\n\t\t\t\t\t<title>Connecting to Popup Maker Pro</title>\n\t\t\t\t\t<style>\n\t\t\t\t\t\tbody { \n\t\t\t\t\t\t\tfont-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;\n\t\t\t\t\t\t\tdisplay: flex; \n\t\t\t\t\t\t\tjustify-content: center; \n\t\t\t\t\t\t\talign-items: center; \n\t\t\t\t\t\t\theight: 100vh; \n\t\t\t\t\t\t\tmargin: 0; \n\t\t\t\t\t\t\tbackground: #f1f1f1; \n\t\t\t\t\t\t\tcolor: #333;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t.loading { text-align: center; }\n\t\t\t\t\t\t.spinner {\n\t\t\t\t\t\t\tborder: 4px solid #e1e1e1;\n\t\t\t\t\t\t\tborder-left: 4px solid #0073aa;\n\t\t\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\t\t\twidth: 40px;\n\t\t\t\t\t\t\theight: 40px;\n\t\t\t\t\t\t\tanimation: spin 1s linear infinite;\n\t\t\t\t\t\t\tmargin: 20px auto;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t@keyframes spin {\n\t\t\t\t\t\t\t0% { transform: rotate(0deg); }\n\t\t\t\t\t\t\t100% { transform: rotate(360deg); }\n\t\t\t\t\t\t}\n\t\t\t\t\t</style>\n\t\t\t\t</head>\n\t\t\t\t<body>\n\t\t\t\t\t<div class="loading">\n\t\t\t\t\t\t<div class="spinner"></div>\n\t\t\t\t\t\t<h2>Connecting to Popup Maker Pro</h2>\n\t\t\t\t\t\t<p>Please wait while we prepare your upgrade...</p>\n\t\t\t\t\t</div>\n\t\t\t\t</body>\n\t\t\t\t</html>\n\t\t\t');if(console.log("Opening loading popup immediately from user gesture"),this.popupWindow=window.open(o,this.popupConfig.name,e),!this.popupWindow)return console.error("Failed to open popup window - likely blocked by browser"),this.showError("Popup blocked! Please allow popups for this site and try again."),!1;try{if(this.popupWindow.closed)return console.error("Popup window was immediately closed"),this.showError("Popup was blocked or closed. Please allow popups for this site."),this.popupWindow=null,!1}catch(t){console.log("Cannot access popup window properties (normal for cross-origin):",t.message)}return this.startPopupMonitoring(),this.showPopupOpenState(),!0},navigatePopupToFinalUrl:function(t){if(!this.popupWindow||this.popupWindow.closed)return console.error("Cannot navigate popup - window not available"),void this.showError("Popup window was closed. Please try again.");const n=this.buildPopupUrl(t);console.log("Navigating existing popup to final URL:",n);try{this.popupWindow.location.href=n}catch(n){console.warn("Could not navigate popup directly, attempting to open new window:",n.message),this.closePopup(),this.openLicensePopup(t)}},startPopupMonitoring:function(){this.isMonitoring||(this.isMonitoring=!0,this.monitorInterval=setInterval(()=>{this.checkPopupState()},500),console.log("Started popup monitoring"))},stopPopupMonitoring:function(){this.isMonitoring&&(this.isMonitoring=!1,this.monitorInterval&&(clearInterval(this.monitorInterval),this.monitorInterval=null),console.log("Stopped popup monitoring"))},checkPopupState:function(){if(!this.popupWindow)return console.log("checkPopupState: popupWindow is null"),void this.handlePopupClosed();try{if(this.popupWindow.closed)return console.log("checkPopupState: popup window was closed"),void this.handlePopupClosed()}catch(t){return console.log("checkPopupState: Error checking popup.closed, treating as closed:",t.message),void this.handlePopupClosed()}try{if(0===this.popupWindow.location.href.indexOf(window.location.origin)){const t=new URLSearchParams(this.popupWindow.location.search);if("1"===t.get("pum_license_connected"))return void this.handleConnectionSuccess(t);if(t.get("pum_license_error"))return void this.handleConnectionError(t.get("pum_license_error"))}}catch(t){}},handlePopupClosed:function(){console.log("License popup closed"),this.stopPopupMonitoring(),this.popupWindow=null,this.hidePopupOpenState(),t(document).trigger("pum_license_popup_closed"),window.PUM_Admin.LicenseStatusPolling&&window.PUM_Admin.LicenseStatusPolling.startPolling()},handleConnectionSuccess:function(n){console.log("License connection successful");const e=n.get("license_key"),o=n.get("license_status");if(this.closePopup(),e){const n=t("#popup_maker_pro_license_key");n.length&&(n.val(e),n.trigger("change"))}this.showSuccess("License connected successfully!"),t(document).trigger("pum_license_connected",{license_key:e,license_status:o}),setTimeout(()=>{window.location.reload()},1500)},handleConnectionError:function(n){console.error("License connection error:",n),this.closePopup(),this.showError(`Connection failed: ${n}`),t(document).trigger("pum_license_connection_error",{error:n})},handleWindowFocus:function(){setTimeout(()=>{this.isMonitoring&&this.popupWindow&&this.popupWindow.closed&&this.handlePopupClosed()},100)},closePopup:function(){this.popupWindow&&!this.popupWindow.closed&&this.popupWindow.close(),this.stopPopupMonitoring(),this.popupWindow=null,this.hidePopupOpenState()},showPopupOpenState:function(){t(".pum-pro-upgrade-trigger, .pum-license-connect-trigger").addClass("pum-popup-open"),this.showMessage("Opening license connection window...","info")},hidePopupOpenState:function(){t(".pum-pro-upgrade-trigger, .pum-license-connect-trigger").removeClass("pum-popup-open")},showSuccess:function(t){this.showMessage(t,"success")},showError:function(t){this.showMessage(t,"error")},showMessage:function(n,e="info"){let o=t("#pum-upgrade-flow-messages");o.length||(o=t('<div id="pum-upgrade-flow-messages" class="pum-upgrade-messages"></div>'),t("#pum-settings-container").prepend(o)),o.empty();const i=t(`\n\t\t\t\t<div class="notice notice-${e} is-dismissible">\n\t\t\t\t\t<p>${n}</p>\n\t\t\t\t\t<button type="button" class="notice-dismiss">\n\t\t\t\t\t\t<span class="screen-reader-text">Dismiss this notice.</span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t`);o.append(i),"error"!==e&&setTimeout(()=>{i.fadeOut(300,function(){t(this).remove()})},3e3),i.find(".notice-dismiss").on("click",function(){i.fadeOut(300,function(){t(this).remove()})})},cleanup:function(){this.closePopup()}};window.PUM_Admin.ProUpgradeFlow=n,t(function(){n.init()}),t(document).on("pum_init",function(){n.init()})}(jQuery)},9010:()=>{!function(t){"use strict";window.PUM_Admin=window.PUM_Admin||{},window.PUM_Admin.LicenseStatusPolling={};const n={isPolling:!1,pollInterval:null,pollTimeout:null,config:{initialInterval:2e3,normalInterval:5e3,slowInterval:1e4,maxDuration:3e5,maxAttempts:60,fastPollDuration:3e4},state:{attempts:0,startTime:null,currentInterval:null,lastResponse:null,consecutiveErrors:0},apiConfig:{endpoint:"",nonce:"",namespace:"popup-maker/v2",route:"license"},init:function(){console.log("Initializing License Status Polling"),this.setupApiConfig(),this.bindEvents()},setupApiConfig:function(){window.wpApiSettings?(this.apiConfig.endpoint=`${window.wpApiSettings.root}${this.apiConfig.namespace}/${this.apiConfig.route}`,this.apiConfig.nonce=window.wpApiSettings.nonce):window.pum_admin_vars?(this.apiConfig.endpoint=window.pum_admin_vars.ajax_url,this.apiConfig.nonce=window.pum_admin_vars.nonce):console.warn("License Status Polling: No API configuration available")},bindEvents:function(){t(document).on("pum_license_popup_closed",this.startPolling.bind(this)),t(document).on("pum_license_connected",this.handleLicenseConnected.bind(this)),t(document).on("visibilitychange",this.handleVisibilityChange.bind(this)),t(window).on("beforeunload",this.stopPolling.bind(this))},startPolling:function(){this.isPolling?console.log("License Status Polling: Already polling"):(console.log("Starting license status polling"),this.resetState(),this.isPolling=!0,this.state.currentInterval=this.config.initialInterval,this.state.startTime=Date.now(),this.performPoll(),this.scheduleNextPoll())},stopPolling:function(){this.isPolling&&(console.log("Stopping license status polling"),this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null),this.pollTimeout&&(clearTimeout(this.pollTimeout),this.pollTimeout=null),this.isPolling=!1)},resetState:function(){this.state={attempts:0,startTime:null,currentInterval:null,lastResponse:null,consecutiveErrors:0}},scheduleNextPoll:function(){if(!this.isPolling)return;const t=Date.now()-this.state.startTime;if(t>this.config.maxDuration||this.state.attempts>=this.config.maxAttempts)return console.log("License Status Polling: Maximum duration/attempts reached, stopping"),void this.stopPolling();this.adjustPollingInterval(t),this.pollTimeout=setTimeout(()=>{this.performPoll(),this.scheduleNextPoll()},this.state.currentInterval)},adjustPollingInterval:function(t){if(t<this.config.fastPollDuration?this.state.currentInterval=this.config.initialInterval:t<2*this.config.fastPollDuration?this.state.currentInterval=this.config.normalInterval:this.state.currentInterval=this.config.slowInterval,this.state.consecutiveErrors>0){const t=Math.min(this.state.consecutiveErrors,4);this.state.currentInterval*=t}},performPoll:function(){if(!this.isPolling)return;this.state.attempts++,console.log(`License Status Poll #${this.state.attempts}`);const n=this.prepareRequestData();t.ajax({url:this.apiConfig.endpoint,type:"GET",data:n,dataType:"json",timeout:1e4,beforeSend:this.setRequestHeaders.bind(this),success:this.handlePollSuccess.bind(this),error:this.handlePollError.bind(this)})},prepareRequestData:function(){const t={_wpnonce:this.apiConfig.nonce,timestamp:Date.now()};return window.wpApiSettings?t:{...t,action:"pum_check_license_status",nonce:this.apiConfig.nonce}},setRequestHeaders:function(t){window.wpApiSettings&&this.apiConfig.nonce&&t.setRequestHeader("X-WP-Nonce",this.apiConfig.nonce)},handlePollSuccess:function(t){console.log("License status poll success:",t),this.state.consecutiveErrors=0,this.state.lastResponse=t,this.hasLicenseStatusChanged(t)&&this.handleStatusChange(t),this.shouldContinuePolling(t)||this.stopPolling()},handlePollError:function(t,n,e){console.warn("License status poll error:",{status:n,error:e,xhr:t}),this.state.consecutiveErrors++,this.state.consecutiveErrors>=5&&(console.error("License Status Polling: Too many consecutive errors, stopping"),this.stopPolling(),this.showError("Unable to check license status. Please refresh the page."))},hasLicenseStatusChanged:function(t){if(!this.state.lastResponse)return!1;const n=this.extractStatusData(t),e=this.extractStatusData(this.state.lastResponse);return JSON.stringify(n)!==JSON.stringify(e)},extractStatusData:function(t){return{is_valid:t.is_valid||!1,license_key:t.license_key||"",status:t.status||"",expires:t.expires||"",pro_installed:t.pro_installed||!1}},handleStatusChange:function(n){console.log("License status changed:",n),t(document).trigger("pum_license_status_changed",n),this.updateLicenseUI(n),n.is_valid&&!n.pro_installed&&this.triggerProInstallation(n)},updateLicenseUI:function(n){const e=t("#popup_maker_pro_license_key"),o=t(".pum-license-status");n.license_key&&e.length&&e.val(n.license_key),o.length&&(o.removeClass("valid invalid"),o.addClass(n.is_valid?"valid":"invalid"),o.find(".pum-license-status-text").text(n.status||"Unknown")),n.is_valid?this.showSuccess("License activated successfully!"):n.status&&this.showError(`License issue: ${n.status}`)},triggerProInstallation:function(n){console.log("Triggering Pro plugin installation"),this.showInfo("Valid license detected! Installing Popup Maker Pro..."),t(document).trigger("pum_install_pro_plugin",n),window.PUM_Admin.ProUpgrader&&window.PUM_Admin.ProUpgrader.installProPlugin(n.license_key)},shouldContinuePolling:function(t){return!t.is_valid||!t.pro_installed||(console.log("License valid and Pro installed, stopping polling"),!1)},handleLicenseConnected:function(t,n){console.log("License connected event received:",n),this.stopPolling(),setTimeout(()=>{this.startPolling()},1e3)},handleVisibilityChange:function(){this.isPolling&&(document.hidden?(console.log("Page hidden, reducing polling frequency"),this.state.currentInterval=2*this.config.slowInterval):(console.log("Page visible, resuming normal polling"),this.adjustPollingInterval(Date.now()-this.state.startTime)))},showSuccess:function(t){this.showMessage(t,"success")},showError:function(t){this.showMessage(t,"error")},showInfo:function(t){this.showMessage(t,"info")},showMessage:function(t,n="info"){window.PUM_Admin.ProUpgradeFlow&&window.PUM_Admin.ProUpgradeFlow.showMessage?window.PUM_Admin.ProUpgradeFlow.showMessage(t,n):console.log(`License Status: [${n.toUpperCase()}] ${t}`)}};window.PUM_Admin.LicenseStatusPolling=n,t(function(){n.init()}),t(document).on("pum_init",function(){n.init()})}(jQuery)}},n={};function e(o){var i=n[o];if(void 0!==i)return i.exports;var s=n[o]={exports:{}};return t[o](s,s.exports,e),s.exports}(()=>{"use strict";var t;e(2639),e(9010),e(6229),t=jQuery,window.PUM_Admin=window.PUM_Admin||{},t(function(){var n=t("#pum-settings-container"),e=pum_settings_editor.form_args||{},o=pum_settings_editor.current_values||{};n.length&&(n.find(".pum-no-js").hide(),PUM_Admin.forms.render(e,o,n))})})()})();
